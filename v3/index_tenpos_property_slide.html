<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>おすすめ店舗物件 - スライドウィジェット</title>
    <!--
      ====================================================
      このファイルはテスト用です。
      クライアントサイトに埋め込む場合は以下を参照してください：
      
      【必要なもの】
      1. rals-widget-cube.js（データ取得用）
      2. rals-widget-cube-config.js（設定用）
      3. 下記の「埋め込み用HTML」セクション
      
      【クライアントサイトで既に読み込み済みのもの】
      - jQuery
      - Swiper.js
      - style.css, content.css
      ====================================================
    -->
    
    <!-- テスト用：クライアントサイトのCSS（本番では不要） -->
    <link rel="stylesheet" href="https://www.tenpos-ft.com/wp/wp-content/themes/responsive_037/style.css" />
    <link rel="stylesheet" href="https://www.tenpos-ft.com/wp/wp-content/themes/responsive_037/css/content.css" />
    <link rel="stylesheet" href="https://www.tenpos-ft.com/wp/wp-content/plugins/elementor/assets/lib/swiper/v8/css/swiper.min.css" />
  </head>
  <body>

    <!-- ====================================================
         埋め込み用HTML（ここから）
         ==================================================== -->
    
    <div class="frontpage-shop__wrapper">
      <div class="frontpage-shop-item">
        <div class="postList">
          <div id="shop-recommend">
            <div class="postSlider">

              <!-- RALS Widget Container -->
              <div
                id="rals-slide-container"
                class="rals-widget-slide"
                data-query="prop=2&sup=2000&limit=4&odr=cdtd"
              >
                <!-- テンプレート -->
                <template id="rals-slide-template">
                  <li class="recommend-item swiper-slide">
                    <a id="rals-tpl-link" href="#">
                      <div class="item-upper">
                        <div id="rals-tpl-img" class="item-img"></div>
                        <div class="item-info__wrapper">
                          <div id="rals-tpl-condition" class="item-condition"></div>
                          <ul class="item-info-list">
                            <li id="rals-tpl-address" class="item-info-item"></li>
                            <li id="rals-tpl-type" class="item-info-item"></li>
                            <li id="rals-tpl-area" class="item-info-item"></li>
                          </ul>
                        </div>
                      </div>
                      <div class="item-below">
                        <span id="rals-tpl-comment"></span>
                      </div>
                    </a>
                  </li>
                </template>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ====================================================
         埋め込み用HTML（ここまで）
         ==================================================== -->


    <!-- テスト用：クライアントサイトのJS（本番では不要） -->
    <script src="https://www.tenpos-ft.com/wp/wp-includes/js/jquery/jquery.min.js"></script>
    <script src="https://www.tenpos-ft.com/wp/wp-content/plugins/elementor/assets/lib/swiper/v8/swiper.min.js"></script>


    <!-- ====================================================
         埋め込み用JS（以下のJSをクライアントサイトに追加）
         ==================================================== -->
    
    <!-- RALS Widget Core -->
    <script src="./assets/rals-widget-cube.js"></script>
    <script src="./assets/rals-widget-cube-config.js"></script>
    
    <!-- Slide Widget Renderer -->
    <script>
      (function() {
        'use strict';
        
        /**
         * RALS Slide Widget
         * クライアントサイト（tenpos-ft.com）と同じHTML構造でスライダーを生成
         */
        async function initRalsSlideWidget() {
          const container = document.getElementById('rals-slide-container');
          if (!container) return;
          
          // 設定を適用
          if (window.RalsWidgetRenderer && window.RalsWidgetRenderer.applyCompanyConfig) {
            window.RalsWidgetRenderer.applyCompanyConfig(container);
          }
          
          // テンプレートを取得
          const template = document.getElementById('rals-slide-template');
          if (!template) {
            console.error('RALS Slide: Template not found');
            return;
          }
          
          // ローディング表示
          container.innerHTML = '<div style="text-align:center;padding:2rem;color:#666;">物件を読み込み中...</div>';
          
          // データ取得
          let properties;
          try {
            properties = await window.RalsWidget3.fetchPropertyData(container);
          } catch (error) {
            console.error('RALS Slide: Fetch error', error);
            container.innerHTML = '<div style="text-align:center;padding:2rem;color:#999;">物件情報の読み込みに失敗しました。</div>';
            return;
          }
          
          if (!properties || properties.length === 0) {
            container.innerHTML = '<div style="text-align:center;padding:2rem;color:#999;">物件が見つかりません。</div>';
            return;
          }
          
          // スライドHTML生成
          const slidesHTML = properties.map(function(property) {
            const clone = template.content.cloneNode(true);
            
            // 画像（background-image）
            const imgEl = clone.querySelector('#rals-tpl-img');
            if (imgEl) {
              const imageUrl = property.thumbnailUrl || container.dataset.fallbackImageUrl || '';
              imgEl.style.background = "url('" + imageUrl + "') center center /cover no-repeat";
              imgEl.removeAttribute('id');
            }
            
            // 条件（居抜き/スケルトン）
            const conditionEl = clone.querySelector('#rals-tpl-condition');
            if (conditionEl) {
              conditionEl.textContent = '居抜き';
              conditionEl.removeAttribute('id');
            }
            
            // 住所 + 建物名
            const addressEl = clone.querySelector('#rals-tpl-address');
            if (addressEl) {
              var addressParts = [];
              if (property.address) addressParts.push(property.address);
              if (property.title) addressParts.push(property.title);
              addressEl.textContent = addressParts.join(' ');
              addressEl.removeAttribute('id');
            }
            
            // 種別
            const typeEl = clone.querySelector('#rals-tpl-type');
            if (typeEl) {
              typeEl.textContent = '店舗';
              typeEl.removeAttribute('id');
            }
            
            // 面積
            const areaEl = clone.querySelector('#rals-tpl-area');
            if (areaEl) {
              areaEl.textContent = property.area || '';
              areaEl.removeAttribute('id');
            }
            
            // コメント
            const commentEl = clone.querySelector('#rals-tpl-comment');
            if (commentEl) {
              commentEl.textContent = property.comment || property.title || '';
              commentEl.removeAttribute('id');
            }
            
            // リンク
            const linkEl = clone.querySelector('#rals-tpl-link');
            if (linkEl) {
              linkEl.href = property.detailUrl || '#';
              linkEl.removeAttribute('id');
            }
            
            return clone.querySelector('li').outerHTML;
          }).join('');
          
          // クライアントサイトと同じ構造で出力
          container.innerHTML = 
            '<div class="frontpage-recommend-slider">' +
              '<ul class="swiper-wrapper">' + slidesHTML + '</ul>' +
            '</div>' +
            '<div class="swiper-button-prev"></div>' +
            '<div class="swiper-button-next"></div>';
          
          // Swiper初期化（クライアントサイトと同じ設定 + autoplay）
          var swiperEl = container.querySelector('.frontpage-recommend-slider');
          if (swiperEl && typeof Swiper !== 'undefined') {
            var swiper = new Swiper(swiperEl, {
              slidesPerView: 1,
              spaceBetween: 20,
              loop: true,
              autoplay: {
                delay: 4000,
                disableOnInteraction: false,
                pauseOnMouseEnter: true
              },
              navigation: {
                nextEl: container.querySelector('.swiper-button-next'),
                prevEl: container.querySelector('.swiper-button-prev')
              },
              breakpoints: {
                769: {
                  slidesPerView: 2,
                  spaceBetween: 36
                }
              }
            });
            
            // autoplayモジュールがない場合のフォールバック
            if (swiper.autoplay && swiper.autoplay.start) {
              swiper.autoplay.start();
            } else {
              // 手動autoplay（4秒ごとにスライド）
              var autoplayInterval = setInterval(function() {
                if (swiper && !swiper.destroyed) {
                  swiper.slideNext();
                } else {
                  clearInterval(autoplayInterval);
                }
              }, 4000);
              
              // マウスホバー時に一時停止
              swiperEl.addEventListener('mouseenter', function() {
                clearInterval(autoplayInterval);
              });
              swiperEl.addEventListener('mouseleave', function() {
                autoplayInterval = setInterval(function() {
                  if (swiper && !swiper.destroyed) {
                    swiper.slideNext();
                  }
                }, 4000);
              });
            }
          }
        }
        
        // DOM準備完了時に初期化
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initRalsSlideWidget);
        } else {
          initRalsSlideWidget();
        }
      })();
    </script>

  </body>
</html>
